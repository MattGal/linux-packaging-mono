From ffb5c90e08d2f619b207c07c25b8551f52e9913e Mon Sep 17 00:00:00 2001
From: Marek Safar <marek.safar@gmail.com>
Date: Sat, 9 May 2015 12:24:20 +0200
Subject: [PATCH] [system.runtime.caching] Remove inappropropriate use of
 Marshal.SizeOf. Fixes #29667

---
 mcs/class/System.Runtime.Caching/ReferenceSources/SRef.cs | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/mcs/class/System.Runtime.Caching/ReferenceSources/SRef.cs b/mcs/class/System.Runtime.Caching/ReferenceSources/SRef.cs
index ce0812b..644a2fc 100644
--- a/mcs/class/System.Runtime.Caching/ReferenceSources/SRef.cs
+++ b/mcs/class/System.Runtime.Caching/ReferenceSources/SRef.cs
@@ -11,14 +11,17 @@ namespace System.Runtime.Caching {
      */
     internal class SRef {
 
-        private Object _sizedRef;
+//        private Object _sizedRef;
 
         internal SRef (Object target) {
-            _sizedRef = target;
+//            _sizedRef = target;
         }
 
         internal long ApproximateSize {
-            get { return (long) Marshal.SizeOf (_sizedRef.GetType ()); }
+            get {
+                // TODO: .net uses System.SizedReference which contains approximate size after Gen 2 collection
+                return 16;
+            }
         }
 
         internal void Dispose() {
-- 
1.9.1

